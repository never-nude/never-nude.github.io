:root{
  --bg:#0b0b0d;
  --panel:#101014;
  --line:#22242a;
  --text:#e7e7ea;
  --muted:#a6a6b0;
  --btn:#14151a;
  --btn2:#1a1c22;
  --focus:#79a7ff;
  --accent:#d8bd7e;
  --side-w:314px;
  --hud-h:58px;
  --combat-h:224px;
}

*{box-sizing:border-box;}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}

#hud{
  height:var(--hud-h);
  padding:0;
  display:grid;
  grid-template-columns:minmax(0, 1fr) var(--side-w);
  align-items:center;
  border-bottom:1px solid var(--line);
}
#hudTitle{
  grid-column:1;
  justify-self:center;
  font-family:"Cinzel", "Trajan Pro", "Times New Roman", serif;
  font-weight:600;
  letter-spacing:0.08em;
  text-transform:uppercase;
  font-size:26px;
  line-height:1;
  text-align:center;
}
#hudMeta,#hudLast{display:none;}

#layout{
  display:grid;
  grid-template-columns:minmax(0, 1fr) var(--side-w);
  height: calc(100% - var(--hud-h) - var(--combat-h));
}

#canvasWrap{position:relative;}
#c{display:block;width:100%;height:100%;}

#side{
  border-left:1px solid var(--line);
  padding:8px;
  overflow:auto;
}

.panel{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:12px;
  padding:8px;
  margin-bottom:6px;
}

.quickUnitList{
  display:grid;
  gap:6px;
}

.quickUnit{
  display:grid;
  grid-template-columns:34px 44px 56px 56px minmax(0, 1fr);
  gap:6px;
  align-items:center;
  padding:5px 6px;
  border:1px solid rgba(255,255,255,0.08);
  border-radius:8px;
  background:rgba(255,255,255,0.02);
}

.uType{
  color:#f0ddae;
  font-size:10px;
  letter-spacing:0.06em;
  text-transform:uppercase;
  font-weight:700;
}

.uStat,
.uAtk{
  color:#d9deea;
  font-size:10px;
  line-height:1.2;
}

.uAtk{
  color:#e7ecf8;
}

.terrainGuideGrid{
  display:grid;
  grid-template-columns:56px 1fr 1fr;
  gap:4px 6px;
  align-items:start;
}

.terrainHead{
  color:#f0ddae;
  font-size:10px;
  letter-spacing:0.05em;
  text-transform:uppercase;
  font-weight:700;
}

.terrainCell{
  color:#d9deea;
  font-size:10px;
  line-height:1.2;
}

.panelTitle{
  font-size:12px;
  letter-spacing:0.08em;
  text-transform:uppercase;
  color:var(--accent);
  font-weight:700;
  margin-bottom:8px;
}

.row{display:flex;gap:6px;align-items:center;margin:4px 0;flex-wrap:wrap;}
.label{width:88px;color:var(--muted);font-size:11px;letter-spacing:0.05em;text-transform:uppercase;}

.btn{
  background:var(--btn);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:10px;
  padding:6px 8px;
  font-weight:650;
  cursor:pointer;
}
.btn:hover{background:var(--btn2);}
.btn.active{outline:2px solid var(--focus);}
.btn.wide{flex:1;justify-content:center;}

.btn:disabled{
  opacity:0.45;
  cursor:not-allowed;
}
.btn:disabled:hover{background:var(--btn);}

.btnGrid{display:grid;grid-template-columns:repeat(5, 1fr);gap:6px;flex:1;}
.editorOnly .btnGrid{grid-template-columns:repeat(3, 1fr);}

.select{
  flex:1;
  background:var(--btn);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:10px;
  padding:6px 8px;
}

.monoVal{
  flex:1;
  min-height:30px;
  display:flex;
  align-items:center;
  padding:4px 8px;
  border:1px solid var(--line);
  border-radius:10px;
  background:#0d0f15;
  color:#c5d4f7;
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
  word-break:break-all;
}

.roomCode{
  justify-content:center;
  letter-spacing:0.16em;
  font-size:15px;
  font-weight:800;
  color:#e7f0ff;
}

.roomCode.empty{
  letter-spacing:0.08em;
  font-size:13px;
  font-weight:650;
  color:var(--muted);
}

.input{
  flex:1;
  background:var(--btn);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:10px;
  padding:6px 8px;
}

.note{
  color:var(--muted);
  font-size:10px;
  line-height:1.25;
  margin-top:4px;
}

.draftStatus{
  color:var(--muted);
  font-size:12px;
  line-height:1.35;
  margin-top:8px;
  border-top:1px dashed rgba(255,255,255,0.08);
  padding-top:8px;
}

.details{
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px;
  margin-top:8px;
  background:rgba(255,255,255,0.02);
}

.details > summary{
  cursor:pointer;
  color:var(--text);
  font-size:12px;
  font-weight:650;
}

.details[open] > summary{
  margin-bottom:8px;
}

.inspectorTitle{
  flex:1;
  font-size:12px;
  font-weight:650;
}

.inspectorMeta{
  color:var(--muted);
  font-size:12px;
  line-height:1.3;
  margin-top:2px;
  margin-bottom:8px;
}

.inspectorGrid{
  display:grid;
  grid-template-columns:auto 1fr;
  column-gap:8px;
  row-gap:4px;
}

.inspectorKey{
  color:var(--muted);
  font-size:11px;
  letter-spacing:0.04em;
  text-transform:uppercase;
}

.inspectorVal{
  font-size:11px;
  font-weight:600;
  word-break:break-word;
}

.diceSummary{
  flex:1;
  color:var(--muted);
  font-size:12px;
  line-height:1.35;
  min-height:2.7em;
}

.diceTray{
  display:none;
  grid-template-columns:repeat(auto-fill, minmax(40px, 1fr));
  gap:8px;
  margin-top:6px;
}

.physicalDiceRow{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  min-height:72px;
  align-items:center;
  justify-content:center;
  padding:8px 10px;
  border:1px dashed rgba(255,255,255,0.14);
  border-radius:10px;
  background:rgba(255,255,255,0.03);
}

.physicalDiceEmpty{
  color:var(--muted);
  font-size:12px;
}

.physicalDie{
  --dice-rot: 0deg;
  width:56px;
  height:56px;
  border-radius:12px;
  border:1px solid #adb4c3;
  background:linear-gradient(162deg, #ffffff 0%, #f0f3f8 60%, #d2d8e3 100%);
  box-shadow:
    0 6px 10px rgba(0,0,0,0.34),
    inset 0 2px 1px rgba(255,255,255,0.9),
    inset 0 -2px 2px rgba(94,104,122,0.35);
  transform:rotate(var(--dice-rot));
  position:relative;
  overflow:hidden;
}

.physicalDie::after{
  content:'';
  position:absolute;
  top:5px;
  left:7px;
  width:62%;
  height:32%;
  border-radius:999px;
  background:rgba(255,255,255,0.45);
  filter:blur(1px);
}

.physicalDie.hit{border-color:#2b8f52;}
.physicalDie.retreat{border-color:#b98018;}
.physicalDie.miss{border-color:#555963;}

.physicalDie.rolling{
  animation:physicalDiceRoll 180ms ease-in-out infinite alternate;
}

.physicalFace{
  position:absolute;
  inset:7px;
  border-radius:9px;
  background:linear-gradient(180deg, #f8fbff 0%, #e9edf3 100%);
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.95);
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  grid-template-rows:repeat(3, 1fr);
}

.physicalPip{
  width:8px;
  height:8px;
  border-radius:50%;
  margin:auto;
  background:#151920;
  opacity:0;
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.2), 0 1px 1px rgba(0,0,0,0.25);
}

.physicalPip.on{opacity:1;}

.die{
  aspect-ratio:1 / 1;
  border:1px solid var(--line);
  border-radius:9px;
  background:linear-gradient(165deg, #ffffff 0%, #ededf1 62%, #dfe1e8 100%);
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.9), 0 2px 5px rgba(0,0,0,0.35);
  position:relative;
  overflow:hidden;
  transform:translateZ(0);
  transition:border-color 120ms ease, box-shadow 120ms ease;
}

.die.hit{border-color:#2b8f52;}
.die.retreat{border-color:#b98018;}
.die.miss{border-color:#555963;}

.die.rolling{
  border-color:#757986;
  animation:dieRoll 210ms ease-in-out infinite alternate;
}

.dieFace{
  width:100%;
  height:100%;
  padding:5px;
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  grid-template-rows:repeat(3, 1fr);
  transition:opacity 100ms ease;
}

.pip{
  width:7px;
  height:7px;
  border-radius:50%;
  margin:auto;
  background:#111317;
  opacity:0;
}

.pip.on{opacity:1;}

.dieBadge{
  position:absolute;
  right:4px;
  bottom:3px;
  font-size:10px;
  font-weight:700;
  color:#1b1c22;
  text-shadow:0 1px 0 rgba(255,255,255,0.55);
}

@keyframes dieRoll{
  0%{transform:translateY(0) rotate(0deg);}
  50%{transform:translateY(-2px) rotate(7deg);}
  100%{transform:translateY(1px) rotate(-7deg);}
}

@keyframes physicalDiceRoll{
  0%{transform:translateY(0) rotate(calc(var(--dice-rot) - 5deg));}
  100%{transform:translateY(1px) rotate(calc(var(--dice-rot) + 5deg));}
}

#combatRail{
  height:var(--combat-h);
  border-top:1px solid var(--line);
  background:linear-gradient(180deg, #0f1218 0%, #0b0d12 100%);
  padding:6px 8px 7px;
  display:grid;
  grid-template-columns:1.2fr 1fr 0.8fr 0.95fr 1fr 1.15fr;
  gap:6px;
  align-items:stretch;
  overflow-x:auto;
  overflow-y:hidden;
}

.combatCol{
  border:1px solid rgba(255,255,255,0.08);
  border-radius:10px;
  background:linear-gradient(180deg, rgba(255,255,255,0.025) 0%, rgba(255,255,255,0.01) 100%);
  padding:5px 7px;
  display:flex;
  flex-direction:column;
  gap:5px;
  min-width:0;
  min-height:0;
  overflow:auto;
  scrollbar-width:thin;
}

.combatColTitle{
  font-size:11px;
  letter-spacing:0.08em;
  text-transform:uppercase;
  color:var(--accent);
  font-weight:700;
}

.combatSummary{
  font-size:10px;
  font-weight:650;
  line-height:1.35;
}

.combatMeta{
  font-size:10px;
  color:#cfd3de;
  line-height:1.35;
}

.diceOutcomeBrief{
  font-weight:700;
  color:#eef2fb;
}

.diceLegendBrief{
  margin-top:0;
}

.combatSupport{
  margin-top:2px;
  padding:6px 8px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.18);
  font-weight:700;
}

.combatSupport.active{
  color:#dff5e8;
  border-color:#2b8f52;
  background:rgba(43,143,82,0.22);
}

.combatSupport.inactive{
  color:#f8deb2;
  border-color:#b98018;
  background:rgba(185,128,24,0.20);
}

.combatSupport.na{
  color:#cfd3de;
  border-color:rgba(255,255,255,0.16);
  background:rgba(255,255,255,0.05);
}

.modifierPreview{
  margin-top:2px;
  padding:6px 8px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.14);
  background:rgba(255,255,255,0.04);
  font-size:12px;
  color:#d9deea;
}

.combatHint{
  font-size:9px;
  color:var(--muted);
  line-height:1.35;
  margin-top:2px;
}

.combatColDice .physicalDiceRow{
  width:100%;
  min-height:72px;
}

.combatColDice .physicalDie{
  width:40px;
  height:40px;
}

.combatColTurn .row{
  margin:0;
  gap:5px;
}

.combatColTurn .label{
  width:54px;
  font-size:10px;
}

.combatColTurn .btn,
.combatColTurn .select{
  min-height:26px;
  padding:4px 7px;
  font-size:11px;
}

.victoryTrackBody{
  display:flex;
  flex-direction:column;
  gap:8px;
  font-size:12px;
  color:#dce2ee;
}

.victoryRow{
  display:grid;
  grid-template-columns:44px 1fr auto;
  align-items:center;
  gap:8px;
}

.victoryLabel{
  font-weight:700;
  letter-spacing:0.04em;
}

.victoryLabel.blue{color:#9ec2ff;}
.victoryLabel.red{color:#ffb2b2;}

.victoryBar{
  height:10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.18);
  background:rgba(255,255,255,0.08);
  overflow:hidden;
}

.victoryFill{
  height:100%;
  width:0%;
  transition:width 220ms ease;
}

.victoryFill.blue{
  background:linear-gradient(90deg, #3e7cff 0%, #8fb4ff 100%);
}

.victoryFill.red{
  background:linear-gradient(90deg, #d34e4e 0%, #ff9a9a 100%);
}

.victoryValue{
  font-size:11px;
  color:#e6e9f2;
  min-width:64px;
  text-align:right;
}

.victoryNote{
  font-size:12px;
  color:#d7dbe6;
  line-height:1.35;
}

.rulesLauncher{
  margin-top:auto;
  display:flex;
  gap:8px;
}

.rulesBtn{
  flex:1;
  padding:6px 8px;
  font-size:11px;
}

.combatColOnline .btn,
.combatColOnline .input,
.combatColOnline .select{
  min-height:27px;
  padding:4px 7px;
  font-size:11px;
}

.combatColOnline .roomCode{
  font-size:12px;
  letter-spacing:0.12em;
}

.combatColOnline .onlineRow{
  display:grid;
  grid-template-columns:34px minmax(0, 1fr) auto;
  gap:6px;
  align-items:center;
}

.combatColOnline .onlineLabel{
  color:var(--muted);
  font-size:10px;
  letter-spacing:0.04em;
  text-transform:uppercase;
}

.onlineDraftBtns{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
}

#onlineRoleHint,
#onlineStatus,
#draftStatus{
  display:none !important;
}

#defensePanel .combatMeta{
  font-size:11px;
  line-height:1.25;
}

.quickSheetGrid{
  display:grid;
  grid-template-columns:46px 78px minmax(0, 1fr);
  column-gap:8px;
  row-gap:4px;
  align-items:center;
}

.quickSheetHead{
  color:#f0ddae;
  font-size:10px;
  letter-spacing:0.05em;
  text-transform:uppercase;
  font-weight:700;
}

.quickSheetCell{
  color:#d9deea;
  font-size:10px;
  line-height:1.2;
}

.quickSheetNote{
  margin-top:6px;
  color:var(--muted);
  font-size:9px;
  line-height:1.2;
}

.rulesModal{
  position:fixed;
  inset:0;
  z-index:2000;
  display:none;
  align-items:center;
  justify-content:center;
  padding:20px;
  background:rgba(4, 6, 12, 0.74);
}

.rulesModal.open{
  display:flex;
}

.rulesCard{
  width:min(900px, 94vw);
  max-height:86vh;
  border:1px solid rgba(255,255,255,0.18);
  border-radius:12px;
  background:linear-gradient(180deg, #131722 0%, #0f121a 100%);
  box-shadow:0 16px 42px rgba(0,0,0,0.55);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.rulesHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,0.12);
}

.rulesModalTitle{
  font-size:13px;
  font-weight:700;
  letter-spacing:0.06em;
  text-transform:uppercase;
  color:var(--accent);
}

.rulesCloseBtn{
  padding:6px 10px;
}

.rulesModalBody{
  padding:12px;
  overflow:auto;
  font-size:13px;
  line-height:1.45;
  color:#e5e9f3;
}

.rulesModalBody h4{
  margin:12px 0 6px;
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:0.06em;
  color:#f1d697;
}

.rulesModalBody p{
  margin:6px 0;
}

@media (max-width: 980px){
  :root{ --combat-h:auto; --hud-h:52px; --side-w:0px; }
  #hud{grid-template-columns:1fr;}
  #layout{grid-template-columns:1fr; height: auto;}
  #side{border-left:none;border-top:1px solid var(--line);}
  .label{width:80px;}
  #combatRail{grid-template-columns:1fr; gap:8px;}
}

body[data-mode="play"] .editorOnly{
  display:none;
}
