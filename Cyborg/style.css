:root{
  --bg:#0b0b0d;
  --panel:#101014;
  --line:#22242a;
  --text:#e7e7ea;
  --muted:#a6a6b0;
  --btn:#14151a;
  --btn2:#1a1c22;
  --focus:#79a7ff;
}

*{box-sizing:border-box;}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}

#hud{
  padding:12px 14px;
  border-bottom:1px solid var(--line);
}
#hudTitle{font-weight:800;letter-spacing:0.02em;}
#hudMeta{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.3;}
#hudLast{margin-top:6px;font-size:13px;}

#layout{
  display:grid;
  grid-template-columns: 1fr 320px;
  height: calc(100% - 86px);
}

#canvasWrap{position:relative;}
#c{display:block;width:100%;height:100%;}

#side{
  border-left:1px solid var(--line);
  padding:12px;
  overflow:auto;
}

.panel{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px;
  margin-bottom:12px;
}

.row{display:flex;gap:8px;align-items:center;margin:8px 0;flex-wrap:wrap;}
.label{width:64px;color:var(--muted);font-size:12px;letter-spacing:0.04em;text-transform:uppercase;}

.btn{
  background:var(--btn);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px 10px;
  font-weight:650;
  cursor:pointer;
}
.btn:hover{background:var(--btn2);}
.btn.active{outline:2px solid var(--focus);}
.btn.wide{flex:1;justify-content:center;}

.btn:disabled{
  opacity:0.45;
  cursor:not-allowed;
}
.btn:disabled:hover{background:var(--btn);}

.btnGrid{display:grid;grid-template-columns:repeat(5, 1fr);gap:6px;flex:1;}

.select{
  flex:1;
  background:var(--btn);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px 10px;
}

.monoVal{
  flex:1;
  min-height:36px;
  display:flex;
  align-items:center;
  padding:6px 10px;
  border:1px solid var(--line);
  border-radius:10px;
  background:#0d0f15;
  color:#c5d4f7;
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
  word-break:break-all;
}

.roomCode{
  justify-content:center;
  letter-spacing:0.22em;
  font-size:20px;
  font-weight:800;
  color:#e7f0ff;
}

.roomCode.empty{
  letter-spacing:0.08em;
  font-size:13px;
  font-weight:650;
  color:var(--muted);
}

.note{
  color:var(--muted);
  font-size:12px;
  line-height:1.35;
  margin-top:10px;
}

.rulesDrawer{
  position:fixed;
  inset:0;
  z-index:40;
  pointer-events:none;
}

.rulesDrawer.open{pointer-events:auto;}

.rulesBackdrop{
  position:absolute;
  inset:0;
  background:rgba(6, 8, 14, 0.62);
  opacity:0;
  transition:opacity 170ms ease;
}

.rulesPanel{
  position:absolute;
  top:0;
  right:0;
  height:100%;
  width:min(520px, 96vw);
  display:flex;
  flex-direction:column;
  background:var(--panel);
  border-left:1px solid var(--line);
  box-shadow:-12px 0 24px rgba(0,0,0,0.45);
  transform:translateX(100%);
  transition:transform 180ms ease;
}

.rulesDrawer.open .rulesBackdrop{opacity:1;}
.rulesDrawer.open .rulesPanel{transform:translateX(0);}

.rulesHeader{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
  padding:14px 14px 10px 14px;
  border-bottom:1px solid var(--line);
  background:#0f1117;
}

.rulesEyebrow{
  color:var(--muted);
  font-size:11px;
  letter-spacing:0.07em;
  text-transform:uppercase;
}

.rulesTitle{
  margin:4px 0 0 0;
  font-size:20px;
  line-height:1.2;
}

.rulesBody{
  overflow:auto;
  padding:12px;
  display:grid;
  gap:10px;
}

.rulesSection{
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  background:#0d0f15;
}

.rulesSection h3{
  margin:0 0 8px 0;
  font-size:14px;
}

.rulesSection p{
  margin:0 0 8px 0;
  color:#d8dbe3;
  font-size:13px;
  line-height:1.4;
}

.rulesSection p:last-child{margin-bottom:0;}

.rulesGrid{
  display:grid;
  grid-template-columns:120px 1fr;
  gap:6px 10px;
}

.rulesKey{
  color:var(--muted);
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.04em;
}

.rulesVal{
  font-size:13px;
  color:#d8dbe3;
}

.inspectorTitle{
  flex:1;
  font-size:13px;
  font-weight:650;
}

.inspectorMeta{
  color:var(--muted);
  font-size:12px;
  line-height:1.3;
  margin-top:2px;
  margin-bottom:8px;
}

.inspectorGrid{
  display:grid;
  grid-template-columns:auto 1fr;
  column-gap:10px;
  row-gap:6px;
}

.inspectorKey{
  color:var(--muted);
  font-size:11px;
  letter-spacing:0.04em;
  text-transform:uppercase;
}

.inspectorVal{
  font-size:12px;
  font-weight:600;
  word-break:break-word;
}

.diceSummary{
  flex:1;
  color:var(--muted);
  font-size:12px;
  line-height:1.35;
  min-height:2.7em;
}

.diceTray{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(40px, 1fr));
  gap:8px;
  margin-top:6px;
}

.die{
  aspect-ratio:1 / 1;
  border:1px solid var(--line);
  border-radius:9px;
  background:linear-gradient(165deg, #ffffff 0%, #ededf1 62%, #dfe1e8 100%);
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.9), 0 2px 5px rgba(0,0,0,0.35);
  position:relative;
  overflow:hidden;
  transform:translateZ(0);
  transition:border-color 120ms ease, box-shadow 120ms ease;
}

.die.hit{border-color:#2b8f52;}
.die.retreat{border-color:#b98018;}
.die.miss{border-color:#555963;}

.die.rolling{
  border-color:#757986;
  animation:dieRoll 210ms ease-in-out infinite alternate;
}

.dieFace{
  width:100%;
  height:100%;
  padding:5px;
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  grid-template-rows:repeat(3, 1fr);
  transition:opacity 100ms ease;
}

.pip{
  width:7px;
  height:7px;
  border-radius:50%;
  margin:auto;
  background:#111317;
  opacity:0;
}

.pip.on{opacity:1;}

.dieBadge{
  position:absolute;
  right:4px;
  bottom:3px;
  font-size:10px;
  font-weight:700;
  color:#1b1c22;
  text-shadow:0 1px 0 rgba(255,255,255,0.55);
}

@keyframes dieRoll{
  0%{transform:translateY(0) rotate(0deg);}
  50%{transform:translateY(-2px) rotate(7deg);}
  100%{transform:translateY(1px) rotate(-7deg);}
}

@media (max-width: 980px){
  #layout{grid-template-columns:1fr; height: auto;}
  #side{border-left:none;border-top:1px solid var(--line);}
  .rulesPanel{width:100%;}
  .rulesGrid{grid-template-columns:1fr;}
  .rulesKey{margin-top:4px;}
}
