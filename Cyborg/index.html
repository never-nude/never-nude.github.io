<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bannerfall</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css?v=20260228-apollo-v1" />
</head>
<body>
  <header id="hud">
    <div id="hudTitle">Bannerfall</div>
    <div id="hudMeta">…</div>
    <div id="hudLast">…</div>
  </header>

  <main id="layout">
    <section id="canvasWrap">
      <canvas id="c"></canvas>
    </section>

    <aside id="side">
      <div id="defensePanel" class="panel">
        <div class="panelTitle">Unit Quick Sheet</div>
        <div class="quickUnitList">
          <div class="quickUnit"><span class="uType">INF</span><span class="uStat">M1</span><span class="uStat">HP 3/4/5</span><span class="uStat">UP 3/5/7</span><span class="uAtk">2 melee</span></div>
          <div class="quickUnit"><span class="uType">CAV</span><span class="uStat">M2</span><span class="uStat">HP 2/3/4</span><span class="uStat">UP 6/8/10</span><span class="uAtk">3 melee</span></div>
          <div class="quickUnit"><span class="uType">SKR</span><span class="uStat">M2</span><span class="uStat">HP 1/2/3</span><span class="uStat">UP 2/3/4</span><span class="uAtk">2 melee, 1@r2</span></div>
          <div class="quickUnit"><span class="uType">ARC</span><span class="uStat">M1</span><span class="uStat">HP 1/2/3</span><span class="uStat">UP 2/4/6</span><span class="uAtk">1 melee, 2@r2, 1@r3</span></div>
          <div class="quickUnit"><span class="uType">GEN</span><span class="uStat">M2</span><span class="uStat">HP 2/3/4</span><span class="uStat">UP 8/10/12</span><span class="uAtk">1 melee</span></div>
          <div class="quickUnit"><span class="uType">RUN</span><span class="uStat">M3/4/5</span><span class="uStat">HP 2/2/2</span><span class="uStat">UP 1/2/3</span><span class="uAtk">No attack</span></div>
          <div class="quickUnit"><span class="uType">MED</span><span class="uStat">M1</span><span class="uStat">HP 1/1/1</span><span class="uStat">UP 4</span><span class="uAtk">Heal +1 adjacent</span></div>
        </div>
        <div class="quickSheetNote">d6: 5-6 hit, 4 retreat, 1-3 miss.</div>
      </div>
      <div id="terrainGuidePanel" class="panel">
        <div class="panelTitle">Terrain Guide</div>
        <div class="terrainGuideGrid">
          <div class="terrainHead">Terrain</div><div class="terrainHead">Move Cost</div><div class="terrainHead">Combat</div>
          <div class="terrainCell">Clear</div><div class="terrainCell">All: 1</div><div class="terrainCell">No modifier</div>
          <div class="terrainCell">Woods</div><div class="terrainCell">INF/ARC/SKR/GEN: 2, CAV: 3</div><div class="terrainCell">Defender gives attacker -1 die; ARC can fire only from tree-line</div>
          <div class="terrainCell">Hills</div><div class="terrainCell">INF/ARC/SKR/GEN: 2, CAV: 3</div><div class="terrainCell">No direct dice mod</div>
          <div class="terrainCell">Rough</div><div class="terrainCell">INF/ARC/SKR/GEN: 2, CAV: 3</div><div class="terrainCell">No direct dice mod</div>
          <div class="terrainCell">Water</div><div class="terrainCell">Impassable</div><div class="terrainCell">Cannot enter</div>
        </div>
      </div>

      <div id="battleSetupSide" class="panel">
        <div class="panelTitle">Battle Setup</div>
        <div class="row">
          <div class="label">Scenario</div>
          <select id="scenarioSel" class="select"></select>
        </div>
        <div class="row">
          <div class="label">Tool</div>
          <button id="toolUnits" class="btn">Units</button>
          <button id="toolTerrain" class="btn">Terrain</button>
        </div>
      </div>

      <div class="panel editorOnly">
        <div class="panelTitle">Editor Tools</div>
        <div class="row">
          <div class="label">Side</div>
          <button id="sideBlue" class="btn">Blue</button>
          <button id="sideRed" class="btn">Red</button>
        </div>

        <div class="row">
          <div class="label">Type</div>
          <div id="typeBtns" class="btnGrid">
            <button class="btn" data-type="inf">Infantry</button>
            <button class="btn" data-type="cav">Cavalry</button>
            <button class="btn" data-type="skr">Skirmisher</button>
            <button class="btn" data-type="arc">Archer</button>
            <button class="btn" data-type="gen">General</button>
            <button class="btn" data-type="run">Runner</button>
            <button class="btn" data-type="iat">Medic</button>
          </div>
        </div>

        <div class="row">
          <button id="eraseBtn" class="btn wide">Erase</button>
        </div>

        <div class="row">
          <div class="label">Quality</div>
          <button id="qGreen" class="btn">Green</button>
          <button id="qRegular" class="btn">Regular</button>
          <button id="qVeteran" class="btn">Veteran</button>
        </div>

        <div class="row">
          <div class="label">Terrain</div>
          <div id="terrainBtns" class="btnGrid">
            <button class="btn" data-terrain="clear">Clear</button>
            <button class="btn" data-terrain="hills">Hills</button>
            <button class="btn" data-terrain="woods">Woods</button>
            <button class="btn" data-terrain="rough">Rough</button>
            <button class="btn" data-terrain="water">Water</button>
          </div>
        </div>

      </div>
    </aside>
  </main>

  <section id="combatRail" aria-live="polite">
    <div class="combatCol combatColBreakdown">
      <div class="combatColTitle">Combat Breakdown</div>
      <div id="combatSummary" class="combatSummary">No combat yet. Select a unit and attack to see exact dice math.</div>
      <div id="combatMath" class="combatMeta">Dice math: -</div>
      <div id="combatTerrain" class="combatMeta">Defense modifiers: -</div>
      <div id="combatSupport" class="combatSupport na">Infantry support: -</div>
      <div id="modifierPreview" class="modifierPreview">Modifier preview: hover or select a unit.</div>
    </div>
    <div id="turnOrdersPanel" class="combatCol combatColTurn">
      <div class="combatColTitle">Turn & Orders</div>
      <div class="row">
        <div class="label">Mode</div>
        <button id="modeBtn" class="btn">To Play</button>
      </div>
      <div class="row">
        <div class="label">Game</div>
        <select id="gameModeSel" class="select">
          <option value="hvh">Human vs Human</option>
          <option value="hvai" selected>Human vs AI</option>
          <option value="online">Online (Host/Guest)</option>
        </select>
      </div>
      <div class="row">
        <div class="label">Play As</div>
        <select id="playerSideSel" class="select">
          <option value="blue">Blue</option>
          <option value="red">Red</option>
        </select>
      </div>
      <div class="row">
        <div class="label">Difficulty</div>
        <select id="aiDifficultySel" class="select">
          <option value="levy">Levy (Easy)</option>
          <option value="cohort">Cohort (Standard)</option>
          <option value="legion">Legion (Hard)</option>
        </select>
      </div>
      <div class="row">
        <div class="label">Victory</div>
        <select id="victorySel" class="select"></select>
      </div>
      <div class="row">
        <button id="endTurnBtn" class="btn wide">End Turn</button>
      </div>
      <div class="row">
        <button id="lineAdvanceBtn" class="btn wide">Line Advance</button>
      </div>
    </div>
    <div class="combatCol combatColDice">
      <div class="combatColTitle">Dice</div>
      <div id="diceSummary" class="diceSummary">No rolls yet.</div>
      <div id="physicalDiceRow" class="physicalDiceRow">
        <span class="physicalDiceEmpty">No dice yet.</span>
      </div>
      <div id="diceOutcomeBrief" class="combatMeta diceOutcomeBrief">This roll: -</div>
      <div id="diceLegendBrief" class="combatHint diceLegendBrief">Legend: 5-6 = hit, 4 = retreat, 1-3 = miss.</div>
      <div class="rulesUnderDice">
        <button id="rulesShortBtn" class="btn rulesBtn">Rules (Short)</button>
        <button id="rulesFullBtn" class="btn rulesBtn">Rules (Full)</button>
      </div>
      <div id="diceTray" class="diceTray"></div>
    </div>
    <div class="combatCol combatColOutcome">
      <div class="combatColTitle">Victory Track</div>
      <div id="victoryTrackBody" class="victoryTrackBody">Victory: -</div>
      <div id="forceTotals" class="forceTotals">Forces: Blue - UP / - HP · Red - UP / - HP</div>
    </div>
    <div class="combatCol combatColOnline">
      <div class="combatColTitle">Online Multiplayer</div>
      <div class="onlineRow">
        <div class="onlineLabel">Room</div>
        <button id="onlineHostBtn" class="btn wide">Create Room</button>
        <button id="onlineLeaveBtn" class="btn">Leave</button>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">Code</div>
        <div id="onlineMyCode" class="monoVal roomCode empty">----</div>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">Join</div>
        <input id="onlineJoinCode" class="input" type="text" maxlength="4" autocomplete="off" spellcheck="false" placeholder="Enter code" />
        <button id="onlineJoinBtn" class="btn">Connect</button>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">Draft</div>
        <select id="draftModeSel" class="select">
          <option value="off">Off</option>
          <option value="visible">Visible Placement</option>
          <option value="fog">Hidden Placement (Reveal)</option>
        </select>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">UP</div>
        <input id="draftBudgetInput" class="input" type="number" min="20" max="300" step="5" value="120" />
      </div>
      <div class="onlineDraftBtns">
        <button id="startDraftBtn" class="btn wide">Start Draft</button>
        <button id="draftDoneBtn" class="btn wide">Done For Side</button>
      </div>
      <div id="draftStatus" class="draftStatus"></div>
      <div id="onlineRoleHint" class="note"></div>
      <div id="onlineStatus" class="note"></div>
      <input id="stateFileInput" type="file" accept=".json,application/json" hidden />
    </div>
  </section>

  <div id="rulesModal" class="rulesModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="rulesModalTitle">
    <div class="rulesCard">
      <div class="rulesHead">
        <div id="rulesModalTitle" class="rulesModalTitle">Rules</div>
        <button id="rulesCloseBtn" class="btn rulesCloseBtn">Close</button>
      </div>
      <div id="rulesModalBody" class="rulesModalBody"></div>
    </div>
  </div>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script src="build.js?v=20260228-apollo-v1"></script>
  <script src="main.js?v=20260228-apollo-v1"></script>
</body>
</html>
