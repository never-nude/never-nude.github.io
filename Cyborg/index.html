<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bannerfall</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css?v=20260228-ui-clean-v39" />
</head>
<body>
  <header id="hud">
    <div id="hudTitle">Bannerfall</div>
    <div id="hudMeta">…</div>
    <div id="hudLast">…</div>
  </header>

  <main id="layout">
    <section id="canvasWrap">
      <canvas id="c"></canvas>
    </section>

    <aside id="side">
      <div class="panel">
        <div class="panelTitle">Turn & Orders</div>
        <div class="row">
          <div class="label">Mode</div>
          <button id="modeBtn" class="btn">To Play</button>
        </div>

        <div class="row">
          <div class="label">Game</div>
          <select id="gameModeSel" class="select">
            <option value="hvh">Human vs Human</option>
            <option value="hvai" selected>Human vs AI</option>
            <option value="online">Online (Host/Guest)</option>
          </select>
        </div>

        <div class="row">
          <div class="label">Difficulty</div>
          <select id="aiDifficultySel" class="select">
            <option value="levy">Levy (Easy)</option>
            <option value="cohort">Cohort (Standard)</option>
            <option value="legion">Legion (Hard)</option>
          </select>
        </div>

        <div class="row">
          <div class="label">Victory</div>
          <select id="victorySel" class="select"></select>
        </div>

        <div class="row">
          <button id="endTurnBtn" class="btn wide">End Turn</button>
        </div>
        <div class="row">
          <button id="lineAdvanceBtn" class="btn wide">Line Advance</button>
        </div>
      </div>

      <div id="defensePanel" class="panel">
        <div class="panelTitle">Defense Modifiers</div>
        <div id="combatTerrain" class="combatMeta">Defense modifiers: -</div>
      </div>

      <div id="setupPanel" class="panel">
        <div class="panelTitle">Battle Setup</div>
        <div class="row">
          <div class="label">Scenario</div>
          <select id="scenarioSel" class="select"></select>
        </div>
        <div class="row">
          <div class="label">Tool</div>
          <button id="toolUnits" class="btn">Units</button>
          <button id="toolTerrain" class="btn">Terrain</button>
        </div>
        <div class="row">
          <button id="loadScenarioBtn" class="btn wide">Load Scenario</button>
          <button id="clearUnitsBtn" class="btn wide">Clear Units</button>
        </div>
      </div>

      <div class="panel editorOnly">
        <div class="panelTitle">Editor Tools</div>
        <div class="row">
          <div class="label">Side</div>
          <button id="sideBlue" class="btn">Blue</button>
          <button id="sideRed" class="btn">Red</button>
        </div>

        <div class="row">
          <div class="label">Type</div>
          <div id="typeBtns" class="btnGrid">
            <button class="btn" data-type="inf">Infantry</button>
            <button class="btn" data-type="cav">Cavalry</button>
            <button class="btn" data-type="skr">Skirmisher</button>
            <button class="btn" data-type="arc">Archer</button>
            <button class="btn" data-type="gen">General</button>
            <button class="btn" data-type="run">Runner</button>
            <button class="btn" data-type="iat">Medic</button>
          </div>
        </div>

        <div class="row">
          <button id="eraseBtn" class="btn wide">Erase</button>
        </div>

        <div class="row">
          <div class="label">Quality</div>
          <button id="qGreen" class="btn">Green</button>
          <button id="qRegular" class="btn">Regular</button>
          <button id="qVeteran" class="btn">Veteran</button>
        </div>

        <div class="row">
          <div class="label">Terrain</div>
          <div id="terrainBtns" class="btnGrid">
            <button class="btn" data-terrain="clear">Clear</button>
            <button class="btn" data-terrain="hills">Hills</button>
            <button class="btn" data-terrain="woods">Woods</button>
            <button class="btn" data-terrain="rough">Rough</button>
            <button class="btn" data-terrain="water">Water</button>
          </div>
        </div>

        <details class="details">
          <summary>Player quick rules</summary>
          <div class="note">
            In <b>Edit</b>, click to place units/terrain. In <b>Play</b>, click a friendly unit to see legal moves (blue) and attacks (red).<br><br>
            Activations: <b>3</b> per turn, and each unit usually acts once.<br>
            Command: units need a friendly <b>General</b> (range 3/4/5 by quality) or <b>Runner</b> relay (range 1).<br>
            Engaged units cannot move, except <b>Skirmishers</b>, <b>Runners</b>, and <b>Veterans</b> may disengage safely by 1 hex.<br>
            <b>Medic</b>: move 1, no attack, 1 HP (always Regular). Heal one adjacent friendly unit for +1 HP as its action.<br>
            <b>Line Advance</b>: select Infantry and press <b>Line Advance</b> (or <b>L</b>) to push a contiguous line one step forward.<br>
            Dice: <b>5–6 hit</b>, <b>4 retreat</b>, <b>1–3 miss</b>.<br>
            <b>Tree-line</b>: Archers in Woods can fire only if that woods hex is adjacent to Clear terrain.<br>
            Hover or select Infantry: light cyan = reinforced unit, darker cyan = reinforcing adjacent units (one line deep only).<br>
            Action flash: red glow + arrow briefly marks move/attack direction.<br>
            Hotkeys: <b>P</b> pass, <b>C</b> command overlay.
          </div>
        </details>
      </div>
    </aside>
  </main>

  <section id="combatRail" aria-live="polite">
    <div class="combatCol combatColBreakdown">
      <div class="combatColTitle">Combat Breakdown</div>
      <div id="combatSummary" class="combatSummary">No combat yet. Select a unit and attack to see exact dice math.</div>
      <div id="combatMath" class="combatMeta">Dice math: -</div>
      <div id="combatHint" class="combatHint">Rules: 5-6 hit, 4 retreat, 1-3 miss. Defender in Woods gives attacker -1 die (minimum 1). Archers in Woods can fire only from tree-line woods (woods hex adjacent to clear). Reinforcement: two adjacent friendly INF touching defender brace opposite attack sides for -1 die (one line deep only).</div>
    </div>
    <div id="selectedUnitPanel" class="combatCol combatColInspector">
      <div class="combatColTitle">Selected Unit</div>
      <div id="inspectorTitle" class="inspectorTitle">No unit selected.</div>
      <div class="inspectorGrid">
        <div class="inspectorKey">Side</div><div id="inspectorSide" class="inspectorVal">-</div>
        <div class="inspectorKey">Type</div><div id="inspectorType" class="inspectorVal">-</div>
        <div class="inspectorKey">Quality</div><div id="inspectorQuality" class="inspectorVal">-</div>
        <div class="inspectorKey">HP</div><div id="inspectorHp" class="inspectorVal">-</div>
        <div class="inspectorKey">UP</div><div id="inspectorUp" class="inspectorVal">-</div>
      </div>
    </div>
    <div class="combatCol combatColDice">
      <div class="combatColTitle">Dice</div>
      <div id="diceSummary" class="diceSummary">No rolls yet.</div>
      <div id="physicalDiceRow" class="physicalDiceRow">
        <span class="physicalDiceEmpty">No dice yet.</span>
      </div>
      <div id="diceOutcomeBrief" class="combatMeta diceOutcomeBrief">This roll: -</div>
      <div id="diceLegendBrief" class="combatHint diceLegendBrief">Legend: 5-6 = hit, 4 = retreat, 1-3 = miss.</div>
      <div id="diceTray" class="diceTray"></div>
    </div>
    <div class="combatCol combatColOutcome">
      <div class="combatColTitle">Outcome</div>
      <div id="combatOutcome" class="combatMeta">Outcome: -</div>
      <div class="combatColTitle">Victory Track</div>
      <div id="victoryTrackBody" class="victoryTrackBody">Victory: -</div>
      <div class="rulesLauncher">
        <button id="rulesShortBtn" class="btn rulesBtn">Rules (Short)</button>
        <button id="rulesFullBtn" class="btn rulesBtn">Rules (Full)</button>
      </div>
    </div>
    <div class="combatCol combatColOnline">
      <div class="combatColTitle">Online Multiplayer</div>
      <div class="onlineRow">
        <div class="onlineLabel">Room</div>
        <button id="onlineHostBtn" class="btn wide">Create Room</button>
        <button id="onlineLeaveBtn" class="btn">Leave</button>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">Code</div>
        <div id="onlineMyCode" class="monoVal roomCode empty">----</div>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">Join</div>
        <input id="onlineJoinCode" class="input" type="text" maxlength="4" autocomplete="off" spellcheck="false" placeholder="Enter code" />
        <button id="onlineJoinBtn" class="btn">Connect</button>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">Draft</div>
        <select id="draftModeSel" class="select">
          <option value="off">Off</option>
          <option value="visible">Visible Placement</option>
          <option value="fog">Hidden Placement (Reveal)</option>
        </select>
      </div>
      <div class="onlineRow">
        <div class="onlineLabel">UP</div>
        <input id="draftBudgetInput" class="input" type="number" min="20" max="300" step="5" value="120" />
      </div>
      <div class="onlineDraftBtns">
        <button id="startDraftBtn" class="btn wide">Start Draft</button>
        <button id="draftDoneBtn" class="btn wide">Done For Side</button>
      </div>
      <div id="draftStatus" class="draftStatus"></div>
      <div id="onlineRoleHint" class="note"></div>
      <div id="onlineStatus" class="note"></div>
      <input id="stateFileInput" type="file" accept=".json,application/json" hidden />
    </div>
  </section>

  <div id="rulesModal" class="rulesModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="rulesModalTitle">
    <div class="rulesCard">
      <div class="rulesHead">
        <div id="rulesModalTitle" class="rulesModalTitle">Rules</div>
        <button id="rulesCloseBtn" class="btn rulesCloseBtn">Close</button>
      </div>
      <div id="rulesModalBody" class="rulesModalBody"></div>
    </div>
  </div>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script src="build.js?v=20260228-ui-clean-v39"></script>
  <script src="main.js?v=20260228-ui-clean-v39"></script>
</body>
</html>
