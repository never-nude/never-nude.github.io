<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apex BUILD0032 (Biome)</title>
  <link rel="stylesheet" href="../style.css?v=BUILD0032_BIOME1">
  <link rel="stylesheet" href="./three32.css?v=BUILD0032_BIOME1">

<style id="lineageStyle">
  #lineage { position: fixed; inset: 0; z-index: 9999; display: flex; align-items: flex-start; justify-content: flex-start;
             padding: 18px; background: rgba(0,0,0,0.55); }
  #lineage.hidden { display: none; }
  #lineage .panel { max-width: 560px; background: rgba(15,16,18,0.92); border: 1px solid rgba(255,255,255,0.12);
                    border-radius: 12px; padding: 12px; color: rgba(235,240,248,0.95);
                    font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
  #lineage .title { letter-spacing: 0.08em; opacity: 0.92; margin-bottom: 10px; }
  #lineage pre { white-space: pre-wrap; margin: 0; }
  #lineage .card { display: block; width: 100%; text-align: left; margin-top: 10px; padding: 10px; border-radius: 10px;
                   background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); color: inherit; }
  #lineage .hint { margin-top: 10px; opacity: 0.8; }
</style>

</head>
<body>
  <canvas id="c"></canvas>

  <div class="hud">
    <div class="buildBox">
      <div class="row"><span class="k">GAME</span><span class="v">E-merge</span></div>
      <div class="row"><span class="k">BUILD</span><span class="v">BUILD0032_BIOME1</span></div>
      <div class="row"><span class="k">PATH</span><span class="v" id="path"></span></div>
      <div class="row"><span class="k">v</span><span class="v" id="vtag"></span></div>
      <div class="row"><span class="k">RENDER</span><span class="v" id="rendererTag"></span></div>
      <div class="row"><span class="k">GEN</span><span class="v" id="genTag"></span></div>
      <div class="row"><span class="k">STAGE</span><span class="v" id="stageTag"></span></div>
      <div class="row"><span class="k">LINE</span><span class="v" id="lineTag"></span></div>
      <div class="row"><span class="k">SOC</span><span class="v" id="socTag"></span></div>
      <div class="row"><span class="k">HERD</span><span class="v" id="herdTag"></span></div>
      <div class="row"><span class="k">DIET</span><span class="v" id="dietTag"></span></div>
      <div class="row"><span class="k">SIGNAL</span><span class="v" id="signalTag"></span></div>
      <div class="row"><span class="k">EPOCH</span><span class="v" id="epochTag"></span></div>
      <div class="row"><span class="k">ECO</span><span class="v" id="ecoTag"></span></div>
      <div class="row"><span class="k">MATE</span><span class="v" id="mateTag"></span></div>
      <div class="row"><span class="k">TRAITS</span><span class="v" id="traitsTag"></span></div>
      <div class="row"><span class="k">LAST</span><span class="v" id="lastTag"></span></div>
      <div class="row"><span class="k">LOADED</span><span class="v" id="loadedAt"></span></div>
    </div>

    <div class="legend">
      <div><span class="chip">WASD</span> move</div>
      <div><span class="chip">Shift</span> sprint</div>
      <div><span class="chip">Space</span> eat</div>
      <div><span class="chip">C</span> call/accept mate</div>
      <div><span class="chip">X</span> reject mate</div>
      <div><span class="chip">Glyph</span> above mates: green=flora • red=fauna • blue=chase</div>
      <div><span class="chip">L</span> lineage slots (1/2/3 load • Shift+1/2/3 save)</div>
      <div><span class="chip">M</span> migrate epoch (Nursery ⇄ Meadow)</div>
      <div><span class="chip">R</span> reset world</div>
    </div>

    <div class="status" id="status" data-epoch="">STATUS: loading…</div>
  </div>

  <div id="overlay" class="overlay hidden">
    <div class="panel">
      <div class="title">MUTATION DRAFT</div>
      <pre id="overlayStats" class="stats"></pre>
      <div id="cards" class="cards"></div>
      <div class="hint">Keys: 1/2/3 choose • Esc abort</div>
    </div>
  </div>

  <div id="lineage" class="overlay hidden">
    <div class="panel">
      <div class="title">LINEAGE SLOTS</div>
      <pre id="lineageNow" class="stats"></pre>
      <div id="lineageSlots" class="cards"></div>
      <div class="hint">L toggle • 1/2/3 load • Shift+1/2/3 save • Esc close</div>
    </div>
  </div>

  
<script id="lineageKeys">
(() => {
  const dispatch = (name, detail) => {
    try { window.dispatchEvent(new CustomEvent(name, { detail })); } catch(e) {}
  };

  window.addEventListener("keydown", (e) => {
    if (e.repeat) return;

    const lin = document.getElementById("lineage");
    const open = !!(lin && !lin.classList.contains("hidden"));

    // L always toggles lineage
    if (e.code === "KeyL") {
      dispatch("emerge_lineage_toggle");
      e.preventDefault();
      e.stopImmediatePropagation();
      return;
    }

    if (!open) return;

    if (e.code === "Escape") {
      dispatch("emerge_lineage_close");
      e.preventDefault();
      e.stopImmediatePropagation();
      return;
    }

    let slot = 0;
    if (e.code === "Digit1") slot = 1;
    else if (e.code === "Digit2") slot = 2;
    else if (e.code === "Digit3") slot = 3;
    else return;

    dispatch(e.shiftKey ? "emerge_lineage_save" : "emerge_lineage_load", { slot });
    e.preventDefault();
    e.stopImmediatePropagation();
  }, true);
})();
</script>

<script type="module" src="./app.js?v=BUILD0032_BIOME1"></script>
</body>
</html>
